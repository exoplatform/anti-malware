<?xml version="1.0" encoding="ISO-8859-1"?>
<!--
 * Copyright (C) 2022 eXo Platform SAS.
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with this program. If not, see <http://www.gnu.org/licenses/>.
 */
-->
<configuration
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.exoplatform.org/xml/ns/kernel_1_3.xsd http://www.exoplatform.org/xml/ns/kernel_1_3.xsd"
        xmlns="http://www.exoplatform.org/xml/ns/kernel_1_3.xsd">

    <component>
        <type>org.exoplatform.antimalware.rest.MalwareDetectionRestService</type>
    </component>

    <component>
        <type>org.exoplatform.antimalware.service.MalwareDetectionService</type>
    </component>

    <external-component-plugins>
        <target-component>org.exoplatform.antimalware.service.MalwareDetectionService</target-component>
        <!-- Malware Detection Files Connector -->
        <component-plugin>
            <name>MalwareDetectionFilesConnector</name>
            <set-method>addMalwareDetectionItemConnector</set-method>
            <type>org.exoplatform.antimalware.connector.MalwareDetectionFilesConnector</type>
            <description>Malware Detection Files Connector</description>
            <init-params>
                <properties-param>
                    <name>constructor.params</name>
                    <property name="enable" value="true"/>
                    <property name="type" value="files"/>
                </properties-param>
            </init-params>
        </component-plugin>
        <!-- TrendMicro Malware Detection Connector -->
        <component-plugin>
            <name>TrendMicroMalwareDetectionConnector</name>
            <set-method>addMalwareDetectionConnector</set-method>
            <type>org.exoplatform.antimalware.connector.TrendMicroMalwareDetectionConnector</type>
            <description>TrendMicro Malware Detection Connector</description>
            <init-params>
                <properties-param>
                    <name>constructor.params</name>
                    <property name="isDefault" value="${exo.malwareDetection.connector.trendMicro.isDefault:false}"/>
                    <property name="type" value="trendMicro"/>
                </properties-param>
            </init-params>
        </component-plugin>
        <!-- Malware Detection Jcr Connector -->
        <component-plugin>
            <name>MalwareDetectionJcrConnector</name>
            <set-method>addMalwareDetectionItemConnector</set-method>
            <type>org.exoplatform.antimalware.connector.MalwareDetectionJcrConnector</type>
            <description>Malware Detection JCR Connector</description>
            <init-params>
                <properties-param>
                    <name>constructor.params</name>
                    <property name="enable" value="true"/>
                    <property name="type" value="jcr"/>
                </properties-param>
            </init-params>
        </component-plugin>
    </external-component-plugins>

    <external-component-plugins>
        <target-component>org.exoplatform.services.scheduler.JobSchedulerService</target-component>
        <component-plugin>
            <name>MalwareDetectionJob</name>
            <set-method>addPeriodJob</set-method>
            <type>org.exoplatform.services.scheduler.PeriodJob</type>
            <description>Job to process malware detection</description>
            <init-params>
                <properties-param>
                    <name>job.info</name>
                    <description>Configuration for malware detection job</description>
                    <!-- Start exceution: a minute after server startup -->
                    <property name="startTime" value="+60000" />
                    <!-- REPEAT_INDEFINITELY -->
                    <property name="endTime" value="" />
                    <property name="jobName" value="MalwareDetectionJob"/>
                    <property name="groupName" value="MalwareDetection"/>
                    <property name="job" value="org.exoplatform.antimalware.job.MalwareDetectionJob"/>
                    <!-- REPEAT_INDEFINITELY -->
                    <property name="repeatCount" value="0" />
                    <!-- Runs every 30 minutes -->
                    <property name="period" value="${exo.antiMalware.MalwareDetectionJob.period:1800000}"/>
                </properties-param>
            </init-params>
        </component-plugin>
    </external-component-plugins>
</configuration>